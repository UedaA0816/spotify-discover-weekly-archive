(this["webpackJsonpspotify-discover-weekly-archive"]=this["webpackJsonpspotify-discover-weekly-archive"]||[]).push([[0],{12:function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return d})),r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return f}));var o=r(22),c=r.n(o),n=r(23),i=r.n(n),a=Object({NODE_ENV:"production",PUBLIC_URL:"/spotify-discover-weekly-archive",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SPOTIFY_API_CLIENT_ID||"",s=Object({NODE_ENV:"production",PUBLIC_URL:"/spotify-discover-weekly-archive",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SPOTIFY_API_CLIENT_SECRET||"",u=Object({NODE_ENV:"production",PUBLIC_URL:"/spotify-discover-weekly-archive",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SPOTIFY_API_REDIRECT_URI||"",l=function(e){return function(e){return i.a.parse(e)}(e)},d=function(){var e=function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}(16);return{redirectUrl:"https://accounts.spotify.com/authorize?"+i.a.stringify({response_type:"code",client_id:a,scope:["user-read-private","user-read-email"],redirect_uri:u,state:e}),state:e}},j=function(t){var r="grant_type=authorization_code&code=".concat(t,"&redirect_uri=").concat(encodeURIComponent(u));return c.a.post("https://accounts.spotify.com/api/token",r,{headers:{Authorization:"Basic ".concat(new e("".concat(a,":").concat(s)).toString("base64")),"Content-Type":"application/x-www-form-urlencoded"},responseType:"json"})},f=function(e){return c.a.get("https://accounts.spotify.com/v1/me",{headers:{Authorization:"Basic ".concat(e)},responseType:"json"})}}).call(this,r(44).Buffer)},40:function(e,t,r){},70:function(e,t,r){"use strict";r.r(t);var o=r(0),c=r.n(o),n=r(16),i=r.n(n),a=(r(40),r(10)),s=r(21),u=r(3),l=r(18),d="user",j={isLogin:!1},f=Object(l.b)({name:"user",initialState:j,reducers:{init:function(e,t){var r=localStorage.getItem(d);return null==r?j:JSON.parse(r)},login:function(e,t){var r=t.payload;return localStorage.setItem(d,JSON.stringify(r)),r},logout:function(e,t){return localStorage.removeItem(d),j}}}),O=f.reducer,b=f.actions,h=b.init,v=b.login,p=b.logout,_=r(9),S=Object(_.b)({user:O}),m=Object(l.a)({reducer:S}),x=a.c,g=r(12),T=r(1),E=function(e){var t=e.children,r=e.onClick;return Object(T.jsx)("button",{className:" box-border border-2 border-spotify border-solid rounded-full p-1.5 px-4 font-semibold text-sm",onClick:r,children:t})};var y=function(){var e=Object(a.b)(),t=x((function(e){return e.user})),r=t.isLogin,o=t.profile;return Object(T.jsxs)("header",{className:" flex items-center border-b border-gray-600 h-14 p-2",children:[Object(T.jsxs)("div",{className:"flex-grow text-lg font-bold whitespace-nowrap overflow-scroll",children:["Spotify Discover Weekly Archive",r&&Object(T.jsxs)("span",{className:"ml-4",children:["ID:",null===o||void 0===o?void 0:o.display_name]})]}),Object(T.jsx)("div",{className:"flex-shrink-0",children:r?Object(T.jsx)(E,{onClick:function(){e(p())},children:"LOG OUT"}):Object(T.jsx)(E,{onClick:function(){var e=Object(g.d)(),t=e.redirectUrl,r=e.state;localStorage.setItem("authorizeState",r),window.location.assign(t)},children:"LOG IN"})})]})};var w=function(){return Object(T.jsx)("div",{children:"home"})};var C=function(){return Object(T.jsx)("div",{children:"welcome"})};var I=function(){var e=x((function(e){return e.user})).isLogin;return Object(T.jsxs)("div",{className:"h-screen flex flex-col",children:[Object(T.jsx)(y,{}),Object(T.jsx)("div",{className:"flex-grow p-8",children:e?Object(T.jsx)(w,{}):Object(T.jsx)(C,{})})]})},P=r(25);var k=function(){var e=Object(u.g)(),t=Object(a.b)(),r=Object(o.useState)(!0),c=Object(P.a)(r,2),n=c[0],i=c[1],s=Object(o.useState)(""),l=Object(P.a)(s,2),d=l[0],j=l[1];return Object(o.useEffect)((function(){console.log(e),j(e.search);var r=Object(g.c)(e.search.replace("?","")),o=r.state,c=r.code;return o!==localStorage.getItem("authorizeState")?(console.error("state_mismatch"),i(!1)):(console.log("state_match"),localStorage.removeItem("authorizeState"),Object(g.a)(c).then((function(e){var r=e.data,o=r.access_token,c=r.refresh_token;return Object(g.b)(o).then((function(e){var r={profile:e.data,accessToken:o,refreshToken:c,isLogin:!0};i(!1),t(v(r))}))})).catch((function(e){console.error(e),i(!1)}))),function(){}}),[t,e,i]),n?Object(T.jsx)("div",{children:d}):Object(T.jsx)(u.a,{to:"/"})};var R=function(){return Object(T.jsx)(u.a,{to:"/"})};var A=function(){var e=Object(a.b)();return Object(o.useEffect)((function(){e(h())}),[e]),Object(T.jsx)("div",{className:"bg-gray-900 text-white h-screen",children:Object(T.jsx)(s.a,{children:Object(T.jsxs)(u.d,{children:[Object(T.jsx)(u.b,{exact:!0,path:"/",component:I}),Object(T.jsx)(u.b,{exact:!0,path:"/authorize",component:k}),Object(T.jsx)(u.b,{component:R})]})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(T.jsx)(c.a.StrictMode,{children:Object(T.jsx)(a.a,{store:m,children:Object(T.jsx)(A,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[70,1,2]]]);
//# sourceMappingURL=main.475ffadb.chunk.js.map