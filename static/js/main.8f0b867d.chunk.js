(this["webpackJsonpspotify-discover-weekly-archive"]=this["webpackJsonpspotify-discover-weekly-archive"]||[]).push([[0],{12:function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return O}));var r=n(22),o=n.n(r),c=n(23),i=n.n(c),a=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SPOTIFY_API_CLIENT_ID||"",s=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SPOTIFY_API_CLIENT_SECRET||"",u=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SPOTIFY_API_REDIRECT_URI||"",l=function(e){return function(e){return i.a.parse(e)}(e)},d=function(){var e=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(16);return{redirectUrl:"https://accounts.spotify.com/authorize?"+i.a.stringify({response_type:"code",client_id:a,scope:["user-read-private","user-read-email"],redirect_uri:u,state:e}),state:e}},j=function(t){var n="grant_type=authorization_code&code=".concat(t,"&redirect_uri=").concat(encodeURIComponent(u));return o.a.post("https://accounts.spotify.com/api/token",n,{headers:{Authorization:"Basic ".concat(new e("".concat(a,":").concat(s)).toString("base64")),"Content-Type":"application/x-www-form-urlencoded"},responseType:"json"})},O=function(e){return o.a.get("https://accounts.spotify.com/v1/me",{headers:{Authorization:"Basic ".concat(e)},responseType:"json"})}}).call(this,n(44).Buffer)},40:function(e,t,n){},70:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),c=n(16),i=n.n(c),a=(n(40),n(10)),s=n(21),u=n(3),l=n(18),d="user",j={isLogin:!1},O=Object(l.b)({name:"user",initialState:j,reducers:{init:function(e,t){var n=localStorage.getItem(d);return null==n?j:JSON.parse(n)},login:function(e,t){var n=t.payload;return localStorage.setItem(d,JSON.stringify(n)),n},logout:function(e,t){return localStorage.removeItem(d),j}}}),b=O.reducer,f=O.actions,h=f.init,v=f.login,p=f.logout,_=n(9),S=Object(_.b)({user:b}),m=Object(l.a)({reducer:S}),x=a.c,g=n(12),T=n(1),E=function(e){var t=e.children,n=e.onClick;return Object(T.jsx)("button",{className:" box-border border-2 border-spotify border-solid rounded-full p-1.5 px-4 font-semibold text-sm",onClick:n,children:t})};var C=function(){var e=Object(a.b)(),t=x((function(e){return e.user})),n=t.isLogin,r=t.profile;return Object(T.jsxs)("header",{className:" flex items-center border-b border-gray-600 h-14 p-2",children:[Object(T.jsxs)("div",{className:"flex-grow text-lg font-bold whitespace-nowrap overflow-scroll",children:["Spotify Discover Weekly Archive",n&&Object(T.jsxs)("span",{className:"ml-4",children:["ID:",null===r||void 0===r?void 0:r.display_name]})]}),Object(T.jsx)("div",{className:"flex-shrink-0",children:n?Object(T.jsx)(E,{onClick:function(){e(p())},children:"LOG OUT"}):Object(T.jsx)(E,{onClick:function(){var e=Object(g.d)(),t=e.redirectUrl,n=e.state;localStorage.setItem("authorizeState",n),window.location.assign(t)},children:"LOG IN"})})]})};var I=function(){return Object(T.jsx)("div",{children:"home"})};var w=function(){return Object(T.jsx)("div",{children:"welcome"})};var y=function(){var e=x((function(e){return e.user})).isLogin;return Object(T.jsxs)("div",{className:"h-screen flex flex-col",children:[Object(T.jsx)(C,{}),Object(T.jsx)("div",{className:"flex-grow p-8",children:e?Object(T.jsx)(I,{}):Object(T.jsx)(w,{})})]})},P=n(25);var R=function(){var e=Object(u.g)(),t=Object(a.b)(),n=Object(r.useState)(!0),o=Object(P.a)(n,2),c=o[0],i=o[1],s=Object(r.useState)(""),l=Object(P.a)(s,2),d=l[0],j=l[1];return Object(r.useEffect)((function(){console.log(e),j(e.search);var n=Object(g.c)(e.search.replace("?","")),r=n.state,o=n.code;return r!==localStorage.getItem("authorizeState")?(console.error("state_mismatch"),i(!1)):(console.log("state_match"),localStorage.removeItem("authorizeState"),Object(g.a)(o).then((function(e){var n=e.data,r=n.access_token,o=n.refresh_token;return Object(g.b)(r).then((function(e){var n={profile:e.data,accessToken:r,refreshToken:o,isLogin:!0};i(!1),t(v(n))}))})).catch((function(e){console.error(e),i(!1)}))),function(){}}),[t,e,i]),c?Object(T.jsx)("div",{children:d}):Object(T.jsx)(u.a,{to:"/"})};var A=function(){return Object(T.jsx)(u.a,{to:"/"})};var N=function(){var e=Object(a.b)();return Object(r.useEffect)((function(){e(h())}),[e]),Object(T.jsx)("div",{className:"bg-gray-900 text-white h-screen",children:Object(T.jsx)(s.a,{children:Object(T.jsxs)(u.d,{children:[Object(T.jsx)(u.b,{exact:!0,path:"/",component:y}),Object(T.jsx)(u.b,{exact:!0,path:"/authorize",component:R}),Object(T.jsx)(u.b,{component:A})]})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(T.jsx)(o.a.StrictMode,{children:Object(T.jsx)(a.a,{store:m,children:Object(T.jsx)(N,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[70,1,2]]]);
//# sourceMappingURL=main.8f0b867d.chunk.js.map